FROM continuumio/miniconda3:4.12.0
ADD ./requirements.dev.txt  /tmp/requirements.txt

RUN apt-get update
RUN apt-get install -y --no-install-recommends \
    build-essential gfortran libgdal-dev cmake git vim curl apt-transport-https ca-certificates \
    gnupg2 software-properties-common
    
RUN curl -fsSL https://download.docker.com/linux/debian/gpg | \
    gpg --dearmor -o /etc/apt/trusted.gpg.d/docker-archive-keyring.gpg
RUN add-apt-repository \
    "deb [arch=amd64,arm64] https://download.docker.com/linux/debian $(lsb_release -cs) stable"
RUN apt-get update
RUN apt-get install -y --no-install-recommends \
    docker-ce docker-ce-cli containerd.io docker-compose-plugin

ENV LANG pt_BR.UTF-8

RUN conda init bash
RUN conda create -n dev python=3.8
RUN echo "conda activate dev" >> ~/.bashrc
SHELL ["/bin/bash", "-c"]

RUN source ~/.bashrc && pip3 install --no-cache-dir -r /tmp/requirements.txt